<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠãƒˆã‚¯é‚„å…ƒãƒã‚§ãƒƒã‚«ãƒ¼ PRO (Deep Context)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f1f5f9; }
        .card-smbc { background: linear-gradient(135deg, #e0f2fe 0%, #ffffff 100%); border-left: 5px solid #0284c7; }
        .card-mufg { background: linear-gradient(135deg, #dcfce7 0%, #ffffff 100%); border-left: 5px solid #16a34a; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body class="min-h-screen pb-32 text-slate-700">
    <div class="max-w-xl mx-auto px-4 pt-6">
        
        <header class="mb-6">
            <h1 class="text-3xl font-black text-slate-800 tracking-tighter">é‚„å…ƒãƒã‚§ãƒƒã‚«ãƒ¼ <span class="text-blue-600 text-lg align-top">PRO</span></h1>
            <p class="text-xs text-slate-500 font-bold mt-1">AI-Powered Reward Logic Analysis</p>
        </header>

        <section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 mb-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-[10px] font-bold text-blue-600 uppercase">SMBC (V-Point)</label>
                        <a href="https://www.smbc-card.com/mem/wp/vpoint_up_program/index.jsp" target="_blank" class="text-[10px] text-blue-400 underline decoration-dotted">å…¬å¼ã‚µã‚¤ãƒˆ</a>
                    </div>
                    <div class="flex items-center bg-slate-50 rounded-lg px-3 py-2 border border-slate-200 focus-within:border-blue-500">
                        <input type="number" id="smbc-rate" step="0.5" class="bg-transparent w-full font-bold outline-none text-blue-700 text-xl font-mono">
                        <span class="text-xs font-bold text-slate-400">%</span>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-[10px] font-bold text-green-600 uppercase">MUFG (Global)</label>
                        <a href="https://www.cr.mufg.jp/mufgcard/point/global/save/convenience_store/index.html" target="_blank" class="text-[10px] text-green-400 underline decoration-dotted">å…¬å¼ã‚µã‚¤ãƒˆ</a>
                    </div>
                    <div class="flex items-center bg-slate-50 rounded-lg px-3 py-2 border border-slate-200 focus-within:border-green-500">
                        <input type="number" id="mufg-rate" step="0.5" class="bg-transparent w-full font-bold outline-none text-green-700 text-xl font-mono">
                        <span class="text-xs font-bold text-slate-400">%</span>
                    </div>
                </div>
            </div>
        </section>

        <div class="sticky top-2 z-20 mb-6">
            <div class="relative shadow-xl shadow-slate-200/50 rounded-2xl">
                <input type="text" id="search" placeholder="åº—åæ¤œç´¢ (ä¾‹: ãƒãƒƒã‚¯, ã‚»ãƒ–ãƒ³, ã‚¬ã‚¹ãƒˆ)..." 
                       class="w-full p-4 pl-5 rounded-2xl border border-slate-100 outline-none text-lg font-bold placeholder-slate-300 focus:ring-4 focus:ring-blue-100 transition-all">
                <div class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-300">ğŸ”</div>
            </div>
        </div>

        <div id="results" class="space-y-3"></div>

        <footer class="mt-12 text-center text-[10px] text-slate-400 pb-10">
            <p>Generated by Gemini 3.0 Series based on official documentation.</p>
            <p class="mt-1">â€»æœ€çµ‚çš„ãªé©ç”¨æ¡ä»¶ã¯å¿…ãšå…¬å¼ã‚µã‚¤ãƒˆã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p>
        </footer>
    </div>

    <script>
        let storeData = [];
        const searchInput = document.getElementById('search');
        const smbcInput = document.getElementById('smbc-rate');
        const mufgInput = document.getElementById('mufg-rate');

        // ã‚«ã‚¿ã‚«ãƒŠãƒ»ã²ã‚‰ãŒãªæ­£è¦åŒ–
        function normalizeKana(str) {
            if (!str) return "";
            let val = str.normalize('NFKC');
            return val.replace(/[\u30a1-\u30f6]/g, m => String.fromCharCode(m.charCodeAt(0) - 0x60)).toLowerCase();
        }

        // åˆæœŸè¨­å®š
        smbcInput.value = localStorage.getItem('otoku-rate-smbc') || "7.0";
        mufgInput.value = localStorage.getItem('otoku-rate-mufg') || "5.5"; // MUFGã¯åŸºæœ¬5.5ã ãŒã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã§å¤‰å‹•ã‚ã‚Š

        // ãƒ‡ãƒ¼ã‚¿å–å¾—
        fetch('./data.json')
            .then(res => res.json())
            .then(data => { 
                storeData = data; 
                render(); 
            })
            .catch(e => {
                document.getElementById('results').innerHTML = `<p class="text-center text-red-400 font-bold">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${e}</p>`;
            });

        [searchInput, smbcInput, mufgInput].forEach(el => el.addEventListener('input', () => {
            localStorage.setItem('otoku-rate-smbc', smbcInput.value);
            localStorage.setItem('otoku-rate-mufg', mufgInput.value);
            render();
        }));

        function render() {
            const query = normalizeKana(searchInput.value);
            const smbcRate = parseFloat(smbcInput.value) || 0;
            const mufgRate = parseFloat(mufgInput.value) || 0;
            const container = document.getElementById('results');
            container.innerHTML = '';

            // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            let filtered = storeData.filter(s => {
                const searchTargets = [
                    s.name, 
                    s.group, 
                    ...(s.aliases || []),
                    s.caution // æ³¨é‡ˆå†…ã®å˜èªï¼ˆä¾‹ï¼šãƒã‚»ã‚¬ãƒ¯ã‚¹ãƒˆã‚¢ï¼‰ã‚‚æ¤œç´¢å¯¾è±¡ã«ã™ã‚‹
                ].map(normalizeKana);
                return searchTargets.some(n => n && n.includes(query));
            });

            // ã‚½ãƒ¼ãƒˆï¼ˆé‚„å…ƒç‡ãŒé«˜ã„é † -> åå‰é †ï¼‰
            filtered = filtered.map(s => ({
                ...s,
                currentRate: (s.card_type === 'SMBC') ? smbcRate : mufgRate
            })).sort((a, b) => b.currentRate - a.currentRate || a.name.localeCompare(b.name));

            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-center text-slate-400 font-bold py-10">è©²å½“ãªã—</p>';
                return;
            }

            filtered.forEach(s => {
                const isSmbc = s.card_type === 'SMBC';
                const themeClass = isSmbc ? 'card-smbc' : 'card-mufg';
                const badgeColor = isSmbc ? 'text-blue-600 bg-blue-100' : 'text-green-600 bg-green-100';
                const cardName = isSmbc ? 'ä¸‰äº•ä½å‹ (SMBC)' : 'ä¸‰è±UFJ (MUFG)';

                // æ³¨é‡ˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆå‡¦ç†ï¼ˆé‡è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’èµ¤å­—ã«ã™ã‚‹ï¼‰
                let cautionHtml = s.caution || "";
                cautionHtml = cautionHtml
                    .replace(/(ä¸å¯|å¯¾è±¡å¤–|ã®ã¿|é™å®š)/g, '<span class="text-red-600 font-bold underline">$1</span>')
                    .replace(/(ç‰©ç†ã‚«ãƒ¼ãƒ‰|QUICPay|Mobile Order)/gi, '<span class="font-bold text-slate-700">$1</span>');

                // è©³ç´°ãƒªã‚¹ãƒˆURLãŒã‚ã‚‹å ´åˆã®ãƒœã‚¿ãƒ³
                const detailLinkBtn = s.url_list 
                    ? `<a href="${s.url_list}" target="_blank" class="ml-2 text-[10px] bg-white border border-slate-200 px-2 py-1 rounded shadow-sm text-slate-500 hover:text-blue-500">åº—èˆ—ä¸€è¦§ â†—</a>` 
                    : '';

                const div = document.createElement('div');
                div.className = `p-5 rounded-2xl shadow-sm border border-slate-100 ${themeClass}`;
                
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[9px] font-black uppercase tracking-wider px-1.5 py-0.5 rounded ${badgeColor}">${cardName}</span>
                                ${s.group ? `<span class="text-[9px] text-slate-400 font-bold">${s.group}</span>` : ''}
                            </div>
                            <h3 class="text-xl font-black text-slate-800 leading-tight flex items-center">
                                ${s.name}
                                ${detailLinkBtn}
                            </h3>
                        </div>
                        <div class="text-right pl-2">
                            <div class="text-3xl font-black text-slate-900 tracking-tighter">${s.currentRate.toFixed(1)}<span class="text-xs text-slate-400 ml-0.5">%</span></div>
                        </div>
                    </div>

                    <div class="mt-3 space-y-2">
                        <div class="bg-white/60 rounded-lg p-2 border border-slate-100/50">
                            <p class="text-[10px] font-bold text-slate-400 uppercase mb-0.5">Payment Rule</p>
                            <p class="text-sm font-bold text-slate-700">${s.payment_rule || 'è¦ç¢ºèª'}</p>
                        </div>

                        ${s.mobile_order_app ? `
                        <div class="inline-block bg-orange-50 text-orange-600 text-[10px] font-bold px-2 py-0.5 rounded border border-orange-100">
                            ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ã‚ªãƒ¼ãƒ€ãƒ¼å¯¾è±¡ã‚ã‚Š
                        </div>` : ''}

                        ${cautionHtml ? `
                        <details class="group mt-1">
                            <summary class="cursor-pointer text-[11px] font-bold text-slate-500 hover:text-slate-800 flex items-center select-none">
                                <span class="mr-1">âš ï¸</span> æ³¨æ„ç‚¹ãƒ»è©³ç´°ã‚’è¡¨ç¤º
                                <span class="ml-auto transform group-open:rotate-180 transition-transform text-slate-300">â–¼</span>
                            </summary>
                            <div class="mt-2 text-xs leading-relaxed text-slate-600 bg-white p-3 rounded-xl border border-slate-100">
                                ${cautionHtml}
                            </div>
                        </details>
                        ` : ''}
                    </div>
                `;
                container.appendChild(div);
            });
        }
    </script>
</body>
</html>
